<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>G.I.S.A. â€” Fotografie</title>

  <style>
    :root{
      --gold:#f2c14d;
      --text:#e9ecff;
      --muted:#b8bfd8;
      --line:rgba(242,193,77,.22);
      --card:rgba(12,14,22,.62);
      --shadow:0 18px 40px rgba(0,0,0,.55);
      --radius:18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at 50% 0%, #121a35 0%, rgba(18,26,53,0) 55%),
        linear-gradient(180deg, #06070b 0%, #04050a 60%, #050612 100%);
      color:var(--text);
    }

    .wrap{max-width:1100px;margin:0 auto;padding:22px}
    .topbar{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(0,0,0,.55);
      border-bottom:1px solid rgba(242,193,77,.18);
    }

    .brand{
      display:flex; align-items:center; justify-content:center;
      padding:14px 10px 8px;
      gap:10px;
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:6px 12px;
      border:1px solid rgba(242,193,77,.25);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      background: rgba(0,0,0,.25);
    }
    h1{
      margin:6px 0 0;
      text-align:center;
      letter-spacing:.22em;
      font-size:34px;
    }

    nav{
      display:flex; justify-content:center; gap:26px;
      padding:12px 10px 14px;
      border-top:1px solid rgba(255,255,255,.06);
    }
    nav a{
      color:var(--gold);
      text-decoration:none;
      font-weight:700;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:13px;
      padding:8px 10px;
      border-radius:10px;
    }
    nav a:hover{background:rgba(242,193,77,.08)}
    nav a.active{outline:1px solid rgba(242,193,77,.25); background:rgba(242,193,77,.06)}

    .header{
      padding:26px 0 8px;
      text-align:center;
    }
    .header p{color:var(--muted); margin:10px auto 0; max-width:820px}

    .panel{
      margin:18px auto 26px;
      background: var(--card);
      border:1px solid rgba(242,193,77,.18);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
    }

    .row{
      display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:space-between;
      margin-bottom:14px;
    }
    .status{
      display:flex; gap:10px; align-items:center; color:var(--muted); font-size:13px;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background:rgba(242,193,77,.9);
      box-shadow:0 0 0 5px rgba(242,193,77,.12);
    }
    .actions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    button, .btn{
      cursor:pointer;
      border-radius:12px;
      padding:10px 12px;
      border:1px solid rgba(242,193,77,.22);
      background:rgba(0,0,0,.28);
      color:var(--text);
      font-weight:700;
      letter-spacing:.02em;
    }
    button:hover, .btn:hover{background:rgba(242,193,77,.10)}
    .btn{
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:14px;
    }
    @media (max-width:980px){
      .grid{grid-template-columns: repeat(2, minmax(0,1fr));}
    }
    @media (max-width:640px){
      .grid{grid-template-columns: 1fr;}
    }

    .card{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.24);
      overflow:hidden;
      position:relative;
      min-height:300px;
    }
    .thumb{
      width:100%;
      height:180px;
      display:block;
      object-fit:cover;
      background:rgba(255,255,255,.04);
    }
    .card .body{padding:12px 12px 14px}
    .title{
      font-size:16px; font-weight:900; margin:4px 0 6px;
    }
    .meta{
      font-size:12px; color:var(--muted);
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .tag{
      border:1px solid rgba(242,193,77,.16);
      background:rgba(242,193,77,.06);
      padding:4px 8px;
      border-radius:999px;
    }

    .note{
      color:var(--muted);
      font-size:12.5px;
      text-align:center;
      padding:10px 0 0;
    }

    /* Lightbox */
    .lightbox{
      position:fixed; inset:0;
      background:rgba(0,0,0,.82);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      z-index:999;
    }
    .lightbox.open{display:flex}
    .lightbox figure{
      margin:0;
      max-width:min(1100px, 96vw);
      max-height:92vh;
    }
    .lightbox img{
      max-width:100%;
      max-height:82vh;
      border-radius:16px;
      border:1px solid rgba(242,193,77,.18);
      display:block;
      background:#0b0c10;
    }
    .lightbox figcaption{
      color:var(--muted);
      font-size:13px;
      margin-top:10px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="wrap">
      <div class="brand">
        <span class="pill">GLOBAL INTELLIGENCE &amp; SECURITY AGENCY <span style="opacity:.9">ðŸ‡®ðŸ‡¹</span></span>
      </div>
      <h1>G.I.S.A.</h1>
      <nav>
        <a href="./">Verifica</a>
        <a href="./info.html">Informazioni</a>
        <a href="./manuale-operatori.html">Manuale Operatori</a>
        <a class="active" href="./galleria.html">Fotografie</a>
      </nav>
    </div>
  </div>

  <main class="wrap">
    <div class="header">
      <h2 style="margin:0; color:var(--gold); letter-spacing:.12em; text-transform:uppercase;">Galleria Fotografica</h2>
      <p>Questa pagina carica automaticamente le immagini presenti nella cartella <b>/uploads</b> del repository GitHub.</p>
    </div>

    <section class="panel">
      <div class="row">
        <div class="status">
          <span class="dot"></span>
          <span id="statusText">Caricamento elenco immaginiâ€¦</span>
        </div>

        <div class="actions">
          <button id="reloadBtn" type="button">Ricarica</button>
          <a class="btn" id="uploadsLink" href="#" target="_blank" rel="noopener">Apri cartella uploads</a>
        </div>
      </div>

      <div id="grid" class="grid"></div>

      <div class="note" id="note">
        Se unâ€™immagine non appare: controlla che sia in <b>/uploads</b> e che il nome file non abbia spazi o caratteri strani.
      </div>
    </section>
  </main>

  <div class="lightbox" id="lightbox" aria-hidden="true">
    <figure>
      <img id="lightboxImg" alt="">
      <figcaption id="lightboxCap"></figcaption>
    </figure>
  </div>

  <script>
    // === CONFIG ===
    const OWNER = "gisa-identity";
    const REPO  = "gisa-verifica-identita";
    const FOLDER = "uploads"; // cartella nel repo
    const BRANCH = "main";

    const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FOLDER}?ref=${BRANCH}`;
    const UPLOADS_WEB = `https://github.com/${OWNER}/${REPO}/tree/${BRANCH}/${FOLDER}`;

    const grid = document.getElementById("grid");
    const statusText = document.getElementById("statusText");
    const reloadBtn = document.getElementById("reloadBtn");
    const uploadsLink = document.getElementById("uploadsLink");

    uploadsLink.href = UPLOADS_WEB;

    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightboxImg");
    const lightboxCap = document.getElementById("lightboxCap");

    function isImage(name){
      return /\.(png|jpe?g|webp|gif)$/i.test(name);
    }

    function niceTitle(filename){
      // foto1.png -> Foto1, distintivo_GISA.jpeg -> Distintivo GISA
      const base = filename.replace(/\.[^/.]+$/, "");
      return base
        .replace(/[_-]+/g, " ")
        .replace(/\s+/g, " ")
        .trim()
        .replace(/^./, c => c.toUpperCase());
    }

    function formatSize(bytes){
      if (!Number.isFinite(bytes)) return "";
      const kb = bytes / 1024;
      if (kb < 1024) return `${kb.toFixed(0)} KB`;
      const mb = kb / 1024;
      return `${mb.toFixed(1)} MB`;
    }

    function openLightbox(src, caption){
      lightboxImg.src = src;
      lightboxImg.alt = caption;
      lightboxCap.textContent = caption;
      lightbox.classList.add("open");
      lightbox.setAttribute("aria-hidden", "false");
    }

    function closeLightbox(){
      lightbox.classList.remove("open");
      lightbox.setAttribute("aria-hidden", "true");
      lightboxImg.src = "";
    }

    lightbox.addEventListener("click", closeLightbox);
    document.addEventListener("keydown", (e)=>{ if(e.key==="Escape") closeLightbox(); });

    async function loadGallery(){
      statusText.textContent = "Caricamento elenco immaginiâ€¦";
      grid.innerHTML = "";

      try{
        const res = await fetch(API_URL, {
          headers: {
            "Accept": "application/vnd.github+json"
          }
        });

        if(!res.ok){
          throw new Error(`GitHub API error: ${res.status}`);
        }

        const items = await res.json();

        const images = items
          .filter(it => it.type === "file" && isImage(it.name))
          .sort((a,b) => a.name.localeCompare(b.name, "it"));

        if(images.length === 0){
          statusText.textContent = "Nessuna immagine trovata in /uploads.";
          return;
        }

        statusText.textContent = `Trovate ${images.length} immagini in /uploads.`;

        for(const img of images){
          const title = niceTitle(img.name);
          const size = formatSize(img.size);
          const src = img.download_url; // URL diretto al file
          const page = img.html_url;

          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `
            <img class="thumb" src="${src}" alt="${title}" loading="lazy">
            <div class="body">
              <div class="title">${title}</div>
              <div class="meta">
                <span class="tag">${img.name}</span>
                <span class="tag">${size}</span>
              </div>
              <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
                <button type="button" class="btnOpen">Apri</button>
                <a class="btn" href="${page}" target="_blank" rel="noopener">Vedi su GitHub</a>
              </div>
            </div>
          `;

          card.querySelector(".btnOpen").addEventListener("click", () => openLightbox(src, title));
          card.querySelector(".thumb").addEventListener("click", () => openLightbox(src, title));

          grid.appendChild(card);
        }

      }catch(err){
        console.error(err);
        statusText.textContent = "Errore nel caricamento. (Possibile limite GitHub API o rete). Riprova.";
      }
    }

    reloadBtn.addEventListener("click", loadGallery);
    loadGallery();
  </script>
</body>
</html>
